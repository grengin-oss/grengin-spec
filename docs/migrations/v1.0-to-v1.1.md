# Migration Guide: v1.0.0 to v1.1.0

This guide covers the breaking changes and new features introduced in v1.1.0.

## Overview

v1.1.0 introduces a consolidated AI engine management system, replacing the previous API key CRUD endpoints. This is a **breaking change** for admin implementations.

## Breaking Changes

### API Key Endpoints Removed

The following endpoints have been removed:

| Removed Endpoint | Replacement |
|------------------|-------------|
| `GET /admin/api-keys` | `GET /admin/ai-engines` |
| `POST /admin/api-keys` | `POST /admin/ai-engines` |
| `PUT /admin/api-keys/{id}` | `PUT /admin/ai-engines/{id}` |
| `DELETE /admin/api-keys/{id}` | `DELETE /admin/ai-engines/{id}` |

### Migration Steps

1. **Update API calls** to use the new `/admin/ai-engines` endpoints
2. **Update request/response handling** to use the new `AIEngine` schema (see below)
3. **Implement model discovery** using `GET /admin/ai-engines/{id}/models`

## New Features

### AI Engine Management

The new AI engine system provides:

- **Consolidated configuration** - Provider credentials, settings, and models in one place
- **Connection validation** - `POST /admin/ai-engines/{id}/validate` to test credentials
- **Model discovery** - `GET /admin/ai-engines/{id}/models` to fetch available models from provider
- **Model whitelisting** - Control which models are available to users

### New Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/admin/ai-engines` | GET | List configured AI engines |
| `/admin/ai-engines` | POST | Add new AI engine |
| `/admin/ai-engines/{id}` | GET | Get engine details |
| `/admin/ai-engines/{id}` | PUT | Update engine configuration |
| `/admin/ai-engines/{id}` | DELETE | Remove AI engine |
| `/admin/ai-engines/{id}/validate` | POST | Validate engine credentials |
| `/admin/ai-engines/{id}/models` | GET | Discover available models |

### New Schemas

- `AIEngine` - Engine configuration (provider, credentials, settings)
- `AIModel` - Model definition with capabilities and parameters
- `AIModelParameter` - Model-specific configuration options

### Per-User Model Access

Administrators can now control model access at the user level:

- Whitelist specific models per user
- Set default model preferences
- Track per-model usage

## Schema Changes

### OpenAPI 3.1 Nullable Style

Nullable fields now use type arrays instead of `nullable: true`:

```yaml
# Before (v1.0)
department_id:
  type: string
  nullable: true

# After (v1.1)
department_id:
  type: [string, "null"]
```

This is a spec-level change and should not affect most client implementations, as generated types handle both styles.

### Chat Schema Enhancements

- Added `model_config` to chat requests for model-specific parameters
- Added `usage` object to responses for token tracking

## Onboarding Endpoints

Onboarding-related endpoints have been moved to a dedicated path file for better organization. The endpoint paths remain unchanged:

- `POST /onboarding/complete`
- `GET /onboarding/status`

## OAuth Callback

Added `POST` handler for `/auth/{provider}/callback` to support OAuth providers that send long authorization codes (e.g., Azure AD) that exceed URL length limits.
