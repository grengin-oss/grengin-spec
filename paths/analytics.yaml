# Usage analytics, cost tracking, and audit logging

# Cost analytics
/analytics/costs:
  get:
    tags:
    - analytics
    summary: Get cost analytics
    description: Get cost breakdown and analytics
    operationId: getCostAnalytics
    security:
    - bearerAuth: []
    parameters:
    - name: start_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: end_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: group_by
      in: query
      schema:
        type: string
        enum: [user, department, model, provider, day]
    responses:
      '200':
        description: Cost analytics
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/CostBreakdown'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/analytics/costs/export:
  get:
    tags:
    - analytics
    summary: Export cost data
    description: Export cost data as CSV for chargeback/billing
    operationId: exportCosts
    security:
    - bearerAuth: []
    parameters:
    - name: start_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: end_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: format
      in: query
      schema:
        type: string
        enum: [csv, json]
        default: csv
    responses:
      '200':
        description: Exported cost data
        content:
          text/csv:
            schema:
              type: string
          application/json:
            schema:
              type: array
              items:
                type: object
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

# Usage analytics
/analytics/usage:
  get:
    tags:
    - analytics
    summary: Get usage analytics
    description: Get usage statistics and trends
    operationId: getUsageAnalytics
    security:
    - bearerAuth: []
    parameters:
    - name: start_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: end_date
      in: query
      required: true
      schema:
        type: string
        format: date
    responses:
      '200':
        description: Usage analytics
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/UsageStats'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/analytics/trends:
  get:
    tags:
    - analytics
    summary: Get cost trends
    description: Get historical cost trends for visualization
    operationId: getCostTrends
    security:
    - bearerAuth: []
    parameters:
    - name: start_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: end_date
      in: query
      required: true
      schema:
        type: string
        format: date
    - name: granularity
      in: query
      schema:
        type: string
        enum: [day, week, month]
        default: day
    responses:
      '200':
        description: Cost trend data
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../openapi.yaml#/components/schemas/CostTrend'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

# Audit logs
/audit/logs:
  get:
    tags:
    - audit
    summary: Get audit logs
    description: Get paginated audit logs with filtering
    operationId: getAuditLogs
    security:
    - bearerAuth: []
    parameters:
    - name: limit
      in: query
      schema:
        type: integer
        default: 50
        minimum: 1
        maximum: 500
    - name: offset
      in: query
      schema:
        type: integer
        default: 0
    - name: user_id
      in: query
      schema:
        type: string
        format: uuid
    - name: action
      in: query
      schema:
        $ref: '../openapi.yaml#/components/schemas/AuditAction'
    - name: resource_type
      in: query
      schema:
        type: string
    - name: start_date
      in: query
      schema:
        type: string
        format: date-time
    - name: end_date
      in: query
      schema:
        type: string
        format: date-time
    - name: search
      in: query
      schema:
        type: string
    responses:
      '200':
        description: Paginated audit logs
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/PaginatedAuditLogs'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/audit/logs/export:
  get:
    tags:
    - audit
    summary: Export audit logs
    description: Export audit logs for compliance reporting
    operationId: exportAuditLogs
    security:
    - bearerAuth: []
    parameters:
    - name: start_date
      in: query
      required: true
      schema:
        type: string
        format: date-time
    - name: end_date
      in: query
      required: true
      schema:
        type: string
        format: date-time
    - name: format
      in: query
      schema:
        type: string
        enum: [csv, json]
        default: csv
    - name: action
      in: query
      schema:
        $ref: '../openapi.yaml#/components/schemas/AuditAction'
    responses:
      '200':
        description: Exported audit logs
        content:
          text/csv:
            schema:
              type: string
          application/json:
            schema:
              type: array
              items:
                $ref: '../openapi.yaml#/components/schemas/AuditLog'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
