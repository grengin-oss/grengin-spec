# Admin panel and management (requires admin role)

/admin/dashboard:
  get:
    tags:
    - admin
    summary: Get admin dashboard
    description: Get admin dashboard with overview statistics
    operationId: getAdminDashboard
    security:
    - bearerAuth: []
    responses:
      '200':
        description: Admin dashboard data
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/AdminDashboard'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

# User management
/admin/users:
  get:
    tags:
    - admin
    summary: List all users
    description: Get paginated list of all users in the organization
    operationId: listUsers
    security:
    - bearerAuth: []
    parameters:
    - name: limit
      in: query
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
    - name: offset
      in: query
      schema:
        type: integer
        default: 0
    - name: search
      in: query
      schema:
        type: string
    - name: role
      in: query
      schema:
        $ref: '../openapi.yaml#/components/schemas/UserRole'
    - name: status
      in: query
      schema:
        $ref: '../openapi.yaml#/components/schemas/UserStatus'
    - name: department
      in: query
      schema:
        type: string
    - name: sort
      in: query
      schema:
        type: string
        enum: [name, email, created_at, last_login_at]
        default: created_at
    - name: order
      in: query
      schema:
        type: string
        enum: [asc, desc]
        default: desc
    responses:
      '200':
        description: Paginated list of users
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/PaginatedUsers'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
  post:
    tags:
    - admin
    summary: Create user
    description: Create a new user manually
    operationId: createUser
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/UserCreate'
    responses:
      '201':
        description: User created
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/User'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '409':
        $ref: '../openapi.yaml#/components/responses/Conflict'

/admin/users/bulk:
  post:
    tags:
    - admin
    summary: Bulk import users
    description: Import multiple users via CSV or JSON
    operationId: bulkImportUsers
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/UserBulkImport'
        multipart/form-data:
          schema:
            type: object
            required: [file]
            properties:
              file:
                type: string
                format: binary
              send_invites:
                type: boolean
                default: true
    responses:
      '200':
        description: Import results
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/UserBulkImportResult'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/admin/users/{user_id}:
  get:
    tags:
    - admin
    summary: Get user details
    description: Get detailed information about a specific user by their ID
    operationId: getUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/UserId'
    responses:
      '200':
        description: User details
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/User'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  put:
    tags:
    - admin
    summary: Update user
    description: Update user details including role, status, and department
    operationId: updateUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/UserId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/UserUpdate'
    responses:
      '200':
        description: Updated user
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/User'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  delete:
    tags:
    - admin
    summary: Deactivate user
    description: Deactivate a user account (does not permanently delete)
    operationId: deactivateUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/UserId'
    responses:
      '204':
        description: User deactivated
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

/admin/users/{user_id}/status:
  patch:
    tags:
    - admin
    summary: Update user status
    description: Activate or deactivate a user account
    operationId: updateUserStatus
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/UserId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/UserStatusUpdate'
    responses:
      '200':
        description: Updated user
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/User'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

/admin/users/{user_id}/usage:
  get:
    tags:
    - admin
    summary: Get user usage
    description: Get usage statistics for a specific user over a time period
    operationId: getUserUsage
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/UserId'
    - name: period
      in: query
      schema:
        type: string
        enum: [day, week, month, year]
        default: month
    responses:
      '200':
        description: User usage statistics
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/CostSummary'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

# Departments
/admin/departments:
  get:
    tags:
    - admin
    summary: List departments
    description: Get list of all departments in the organization
    operationId: listDepartments
    security:
    - bearerAuth: []
    responses:
      '200':
        description: List of departments
        content:
          application/json:
            schema:
              type: object
              required:
                - departments
              properties:
                departments:
                  type: array
                  items:
                    type: object
                    required:
                      - name
                      - user_count
                    properties:
                      name:
                        type: string
                        description: Department name
                      user_count:
                        type: integer
                        description: Number of users in this department
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

# Organization
/admin/organization:
  get:
    tags:
    - admin
    summary: Get organization settings
    description: Get current organization settings including SSO providers and AI engine configurations
    operationId: getOrganization
    security:
    - bearerAuth: []
    responses:
      '200':
        description: Organization settings
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Organization'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
  put:
    tags:
    - admin
    summary: Update organization settings
    description: Update organization settings including allowed domains and AI engine configurations
    operationId: updateOrganization
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/OrganizationUpdate'
    responses:
      '200':
        description: Updated organization
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Organization'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

# AI Engines - consolidated management for engine config, API keys, and model whitelist
/admin/ai-engines:
  get:
    tags:
    - admin
    summary: List AI engines
    description: |
      List all AI engines with their configuration and API key status.
      Returns both enabled and disabled engines for complete visibility.
    operationId: listAIEngines
    security:
    - bearerAuth: []
    responses:
      '200':
        description: List of AI engines with their configuration
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../openapi.yaml#/components/schemas/AIEngineDetail'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/admin/ai-engines/{engine_key}:
  get:
    tags:
    - admin
    summary: Get AI engine details
    description: Get detailed configuration for a specific AI engine
    operationId: getAIEngine
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/EngineKey'
    responses:
      '200':
        description: AI engine details
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/AIEngineDetail'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  put:
    tags:
    - admin
    summary: Update AI engine
    description: |
      Update AI engine configuration including enable/disable, API key, and model whitelist.
      Setting api_key will replace the existing key. Omit to keep current key.
    operationId: updateAIEngine
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/EngineKey'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/AIEngineUpdate'
    responses:
      '200':
        description: Updated AI engine configuration
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/AIEngineDetail'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

/admin/ai-engines/{engine_key}/validate:
  post:
    tags:
    - admin
    summary: Validate AI engine API key
    description: Test the configured API key by making a validation request to the provider
    operationId: validateAIEngineKey
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/EngineKey'
    responses:
      '200':
        description: Validation result
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/AIEngineValidateResponse'
      '400':
        description: No API key configured for this engine
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Error'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

/admin/ai-engines/{engine_key}/models:
  get:
    tags:
    - admin
    summary: Fetch available models from provider
    description: |
      Query the AI provider's API to get a list of available models.
      Requires a valid API key to be configured for this engine.
      Returns models with their whitelist status.
    operationId: getAIEngineModels
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/EngineKey'
    responses:
      '200':
        description: List of available models from the provider
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/AIEngineModelsResponse'
      '400':
        description: No API key configured or API key invalid
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Error'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

/admin/ai-engines/{engine_key}/api-key:
  delete:
    tags:
    - admin
    summary: Remove AI engine API key
    description: Remove the configured API key from this engine (disables the engine)
    operationId: deleteAIEngineKey
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/EngineKey'
    responses:
      '200':
        description: API key removed, engine disabled
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/AIEngineDetail'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

# SSO providers
/admin/sso-providers:
  get:
    tags:
    - admin
    summary: List SSO providers
    description: List all configured SSO/OIDC providers for the organization
    operationId: listSsoProviders
    security:
    - bearerAuth: []
    responses:
      '200':
        description: List of SSO provider configurations
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../openapi.yaml#/components/schemas/OidcProviderConfig'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
  post:
    tags:
    - admin
    summary: Add SSO provider
    description: Configure a new SSO/OIDC provider for the organization
    operationId: createSsoProvider
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/OidcProviderConfigCreate'
    responses:
      '201':
        description: SSO provider configured
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/OidcProviderConfig'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/admin/sso-providers/{provider_id}:
  get:
    tags:
    - admin
    summary: Get SSO provider
    description: Get configuration details for a specific SSO provider
    operationId: getSsoProvider
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/ProviderId'
    responses:
      '200':
        description: SSO provider configuration
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/OidcProviderConfig'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  put:
    tags:
    - admin
    summary: Update SSO provider
    description: Update configuration for an existing SSO provider
    operationId: updateSsoProvider
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/ProviderId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/OidcProviderConfigCreate'
    responses:
      '200':
        description: Updated SSO provider
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/OidcProviderConfig'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  delete:
    tags:
    - admin
    summary: Delete SSO provider
    description: Remove an SSO provider configuration from the organization
    operationId: deleteSsoProvider
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/ProviderId'
    responses:
      '204':
        description: SSO provider deleted
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

/admin/sso-providers/{provider_id}/test:
  post:
    tags:
    - admin
    summary: Test SSO provider
    description: Test SSO provider configuration by checking OIDC discovery endpoints
    operationId: testSsoProvider
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/ProviderId'
    responses:
      '200':
        description: Test result
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string
                discovery_url:
                  type: string
                  format: uri
                endpoints_found:
                  type: object
                  properties:
                    authorization:
                      type: boolean
                    token:
                      type: boolean
                    userinfo:
                      type: boolean
                    jwks:
                      type: boolean
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

# Rate limits
/admin/rate-limits:
  get:
    tags:
    - admin
    summary: List rate limit configurations
    description: List all rate limit configurations for users, departments, or organization
    operationId: listRateLimits
    security:
    - bearerAuth: []
    parameters:
    - name: scope
      in: query
      schema:
        $ref: '../openapi.yaml#/components/schemas/RateLimitScope'
    responses:
      '200':
        description: List of rate limit configurations
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../openapi.yaml#/components/schemas/RateLimitConfig'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
  post:
    tags:
    - admin
    summary: Create rate limit
    description: Create a new rate limit configuration for a user, department, or organization
    operationId: createRateLimit
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/RateLimitConfigCreate'
    responses:
      '201':
        description: Rate limit created
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/RateLimitConfig'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/admin/rate-limits/{limit_id}:
  put:
    tags:
    - admin
    summary: Update rate limit
    description: Update an existing rate limit configuration
    operationId: updateRateLimit
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/LimitId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/RateLimitConfigCreate'
    responses:
      '200':
        description: Updated rate limit
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/RateLimitConfig'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  delete:
    tags:
    - admin
    summary: Delete rate limit
    description: Remove a rate limit configuration
    operationId: deleteRateLimit
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/LimitId'
    responses:
      '204':
        description: Rate limit deleted
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

# Budgets
/admin/budgets:
  get:
    tags:
    - admin
    summary: List budgets
    description: List all budget configurations for users, departments, or organization
    operationId: listBudgets
    security:
    - bearerAuth: []
    parameters:
    - name: scope
      in: query
      schema:
        $ref: '../openapi.yaml#/components/schemas/RateLimitScope'
    responses:
      '200':
        description: List of budgets
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../openapi.yaml#/components/schemas/Budget'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
  post:
    tags:
    - admin
    summary: Create budget
    description: Create a new budget configuration with spending limits and alerts
    operationId: createBudget
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/BudgetCreate'
    responses:
      '201':
        description: Budget created
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Budget'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

/admin/budgets/{budget_id}:
  put:
    tags:
    - admin
    summary: Update budget
    description: Update an existing budget configuration
    operationId: updateBudget
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/BudgetId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/BudgetCreate'
    responses:
      '200':
        description: Updated budget
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Budget'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
  delete:
    tags:
    - admin
    summary: Delete budget
    description: Remove a budget configuration
    operationId: deleteBudget
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../openapi.yaml#/components/parameters/BudgetId'
    responses:
      '204':
        description: Budget deleted
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
